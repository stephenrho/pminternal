<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate optimism and bias-corrected scores via bootstrap resampling — boot_optimism • pminternal</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate optimism and bias-corrected scores via bootstrap resampling — boot_optimism"><meta name="description" content="Estimate bias-corrected scores via calculation of bootstrap optimism (standard or .632).
Can also produce estimates for assessing the stability of prediction model predictions.
This function is called by validate."><meta property="og:description" content="Estimate bias-corrected scores via calculation of bootstrap optimism (standard or .632).
Can also produce estimates for assessing the stability of prediction model predictions.
This function is called by validate."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pminternal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pminternal.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/missing-data.html">Handling missing data</a></li>
    <li><a class="dropdown-item" href="../articles/validate-examples.html">More examples</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stephenrho/pminternal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate optimism and bias-corrected scores via bootstrap resampling</h1>
      <small class="dont-index">Source: <a href="https://github.com/stephenrho/pminternal/blob/main/R/boot_optimism.R" class="external-link"><code>R/boot_optimism.R</code></a></small>
      <div class="d-none name"><code>boot_optimism.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate bias-corrected scores via calculation of bootstrap optimism (standard or .632).
Can also produce estimates for assessing the stability of prediction model predictions.
This function is called by <code><a href="validate.html">validate</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">boot_optimism</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">outcome</span>,</span>
<span>  <span class="va">model_fun</span>,</span>
<span>  <span class="va">pred_fun</span>,</span>
<span>  <span class="va">score_fun</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"boot"</span>, <span class="st">".632"</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>the data used in developing the model. Should contain all variables considered (i.e., even those excluded by variable selection in the development sample)</p></dd>


<dt id="arg-outcome">outcome<a class="anchor" aria-label="anchor" href="#arg-outcome"></a></dt>
<dd><p>character denoting the column name of the outcome in <code>data</code>.</p></dd>


<dt id="arg-model-fun">model_fun<a class="anchor" aria-label="anchor" href="#arg-model-fun"></a></dt>
<dd><p>a function that takes at least one argument, <code>data</code>. This function should implement the entire model development procedure (i.e., hyperparameter tuning, variable selection, imputation). Additional arguments can be provided via <code>...</code>. This function should return an object that works with <code>pred_fun</code>.</p></dd>


<dt id="arg-pred-fun">pred_fun<a class="anchor" aria-label="anchor" href="#arg-pred-fun"></a></dt>
<dd><p>function that takes at least two arguments, <code>model</code> and <code>data</code>. This function should return a numeric vector of predicted probabilities of the outcome with the same length as the number of rows in <code>data</code> so it is important to take into account how missing data is treated (e.g., <code>predict.glm</code> omits predictions for rows with missing values). see <code><a href="../articles/missing-data.html">vignette("missing-data", package = "pminternal")</a></code>.</p></dd>


<dt id="arg-score-fun">score_fun<a class="anchor" aria-label="anchor" href="#arg-score-fun"></a></dt>
<dd><p>a function to calculate the metrics of interest. If this is not specified <code><a href="score_binary.html">score_binary</a></code> is used.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>"boot" or ".632". The former estimates bootstrap optimism for each score and subtracts
from apparent scores (simple bootstrap estimates are also produced as a by-product).
The latter estimates ".632" optimism as described in Harrell (2015). See <code><a href="validate.html">validate</a></code> details.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>number of bootstrap resamples to run</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments for <code>model_fun</code>, <code>pred_fun</code>, and/or <code>score_fun</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list of class <code>internal_boot</code> containing:</p><ul><li><p><code>apparent</code> - scores calculated on the original data using the original model.</p></li>
<li><p><code>optimism</code> - estimates of optimism for each score (average difference in score for bootstrap models evaluated on bootstrap vs original sample) which can be subtracted from 'apparent' performance calculated using the original model on the original data.</p></li>
<li><p><code>corrected</code> - 'bias corrected' scores (apparent - optimism)</p></li>
<li><p><code>simple</code> - if method = "boot", estimates of scores derived from the 'simple bootstrap'. This is the average of each score calculated from the bootstrap models evaluated on the original outcome data. NULL if method = ".632"</p></li>
<li><p><code>stability</code> - if method = "boot", a N,(B+1) matrix where N is the number of observations in <code>data</code> and <code>B</code> is the number of bootstrap samples. The first column contains the original predictions and each of subsequent B columns contain the predicted probabilities of the outcome from each bootstrap model evaluated on the original data. There may be fewer than B+1 columns if errors occur during resamples (when model_fun throws an error all scores are NA). NULL if method = ".632"</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Steyerberg, E. W., Harrell Jr, F. E., Borsboom, G. J., Eijkemans, M. J. C., Vergouwe, Y., &amp; Habbema, J. D. F. (2001). Internal validation of predictive models: efficiency of some procedures for logistic regression analysis. Journal of clinical epidemiology, 54(8), 774-781.</p>
<p>Harrell Jr F. E. (2015). Regression Modeling Strategies: with applications to linear models, logistic and ordinal regression, and survival analysis. New York: Springer Science, LLC.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenrho/pminternal" class="external-link">pminternal</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># simulate data with two predictors that interact</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">pmcalibration</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmcalibration/man/sim_dat.html" class="external-link">sim_dat</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, a1 <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, a3 <span class="op">=</span> <span class="op">-</span><span class="fl">.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.186</span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">LP</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># remove linear predictor</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a (misspecified) logistic regression model</span></span></span>
<span class="r-in"><span><span class="va">model_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>, data<span class="op">=</span><span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pred_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata<span class="op">=</span><span class="va">data</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">boot_optimism</span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span>, outcome<span class="op">=</span><span class="st">"y"</span>, model_fun<span class="op">=</span><span class="va">model_fun</span>, pred_fun<span class="op">=</span><span class="va">pred_fun</span>,</span></span>
<span class="r-in"><span>              method<span class="op">=</span><span class="st">"boot"</span>, B<span class="op">=</span><span class="fl">20</span><span class="op">)</span> <span class="co"># B set to 20 for example but should be &gt;= 200</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          C   Brier Intercept  Slope    Eavg     E50     E90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Apparent            0.7964  0.1262   6.6e-15  1.000  0.0195  0.0162  0.0328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimism            0.0049 -0.0018   1.0e-02  0.016  0.0044  0.0051  0.0076</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B Optimism         20.0000 20.0000   2.0e+01 20.000 20.0000 20.0000 20.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimism Corrected  0.7915  0.1280  -1.0e-02  0.984  0.0151  0.0111  0.0251</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple Corrected    0.7953  0.1268  -1.0e-02  0.984  0.0222  0.0157  0.0458</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B Simple           20.0000 20.0000   2.0e+01 20.000 20.0000 20.0000 20.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      Emax    ECI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Apparent            0.101  0.062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimism            0.020  0.048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B Optimism         20.000 20.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimism Corrected  0.081  0.014</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple Corrected    0.109  0.099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B Simple           20.000 20.000</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stephen Rhodes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

